<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Details</title>
    <style>
        .img {
            width: 20%;
            height: auto;
        }
    </style>    
<script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />

</head>
<body>
    <h1>**DETAILS PAGE**</h1>
    <div>
        <p><%= success %> </p>
        <p><%= deleted %> </p>
        <h1><%= trip.place %></h1>
        <h2><%= trip.owner.username %></h2>
        <% for (let img of trip.images) {%>
            <img src="<%= img.url %>" alt="...">
        <% } %>  
        <p><%= trip.description %></p>
        <div id='map' style='width: 400px; height: 300px;'></div>
        <% if(currentUser) {%> 
        <form action="/trips/<%= trip._id %>/comments" method="POST">
            <h2>Comments:</h2>
            <label for="comment">Add comment</label>
            <br>
            <textarea name="comment[body]" id="comment" cols="30" rows="4" required></textarea>
            <button>Add</button>
        </form>
        <% } %> 
        <div>
            <% for(c of trip.comments){ %>
                <p><b><%= c.owner.username %> - </b></p> 
                <p><%= c.body %></p>
                <% if(currentUser && c.owner.equals(currentUser._id)) {%> 
                <form action="/trips/<%= trip._id%>/comments/<%= c._id %>?_method=DELETE" method="POST">
                    <button>Delete</button>
                </form>
                <% } %> 
            <% } %> 
        </div>
        <button><a href="/trips">Go Back</a></button><br>
        <% if(currentUser && trip.owner.equals(currentUser._id)) {%> 
        <button><a href="/trips/<%= trip._id %>/edit">Edit</a></button>
        <form action="/trips/<%= trip._id %>?_method=DELETE" method="POST">
            <button>Delete</button>
        </form>
        <% } %> 
    </div>
    <script>
        const trip = <%-JSON.stringify(trip)%>
    </script>
<script>
    mapboxgl.accessToken = '<%-process.env.TOKEN%>';
    var map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/streets-v11', // style URL
        center: trip.geometry.coordinates, // starting position [lng, lat]
        zoom: 9 // starting zoom
    });

    new mapboxgl.Marker()
        .setLngLat(trip.geometry.coordinates)
        .addTo(map)
</script>
</body>

</html>